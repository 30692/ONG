<!DOCTYPE html>
<html>
  <head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Painel Administrativo</title>
  </head>

  <body>

     <table>
         <thead>
             <tr>
             <th>CNPJ</th>
             <th>Email</th>
             <th>Senha</th>
             <th>Nome</th>
             <th>Setor</th>
             <th>EDITAR</th>
             <th>DELETAR</th>
            </tr>
         </thead>
         <tbody id="tabela">
         </tbody>
         <tfoot>
             <tr>
                <td colspan="5">
                    <a class="waves-effect waves-light btn modal-trigger"  href="#modal-criacao">
                        CRIAR ONG
                    </a>
                </td>
             </tr>
         </tfoot>

     </table>


  <!-- Modal Structure -->
  <div id="modal-edicao" class="modal">
    <div class="modal-content">
            <div class="row">
              <form id="form-edicao" class="col s12">
                  <input type="hidden" id="ed-CNPJ" name="CNPJ" />
                      <div class="row container">
                        <div class="input-field col s12">
                                <input placeholder="Placeholder" id="ed-CNPJ" name="CNPJ" type="text" class="validate">
                                <label for="nome">CNPJ</label>
                        </div>
                        <div class="input-field col s12">
                                <input placeholder="Placeholder" id="ed-Email" name="Email" type="text" class="validate">
                                <label for="curso">Email</label>
                        </div>
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="ed-Senha" name="Senha" type="password" class="validate">
                            <label for="curso">Senha</label>
                    </div>                     
                </div>
            </form>
        </div>
    </div>
    <div class="modal-footer">
            <a onclick="editar()" href="#!" style="color: white" class="modal-close waves-effect waves-blue btn-flat blue">EDITAR</a>
    </div>
  </div>


  <!-- Modal Structure -->
  <div id="modal-criacao" class="modal">
        <div class="modal-content">
                <div class="row">
                  <form id="form-criacao" class="col s12">
                          <div class="row container">
                            <div class="input-field col s12">
                              <input placeholder="Placeholder" id="cr-CNPJ" name="CNPJ" type="text" class="validate">
                              <label for="rm">CNPJ</label>
                            </div>
                            <div class="input-field col s12">
                                    <input placeholder="Placeholder" id="cr-Email" name="Email" type="text" class="validate">
                                    <label for="nome">Email</label>
                            </div>
                            <div class="input-field col s12">
                                <input placeholder="Placeholder" id="cr-Senha" name="Senha" type="password" class="validate">
                                <label for="nome">Senha</label>
                        </div>
                            <div class="input-field col s12">
                                    <input placeholder="Placeholder" id="cr-Nome" name="Nome" type="text" class="validate">
                                    <label for="curso">Nome</label>
                            </div>
                                             <div class="input-field col s12">
                                                <input placeholder="Placeholder" id="cr-Setor" name="Setor" type="text" class="validate">
                                                <label for="curso">Setor</label>
                            </div>                        
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
                <a onclick="criarOng()" href="#!" style="color: white" class="modal-close waves-effect waves-green btn-flat green">CRIAR ONG</a>
        </div>
      </div>

      <!-- Modal Structure -->
  <div id="modal-delecao" class="modal">
        <div class="modal-content">
           <h5>Confirmar Deleção da Ong</h5>
        </div>
        <form id="form-delecao">
            <input type="hidden" name="rm" id="dl-CNPJ"  />
        </form>
        <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect btn-flat">NÃO</a>
                <a onclick="deletarOng()" href="#!" style="color: white" class="modal-close waves-effect waves-red btn-flat red">CONFIRMA DELEÇÃO</a>
        </div>
    </div>

    Busca: <input type="text" name="busca" id="busca">


    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script>
         let modalCriacao = null;
         let modalEdicao = null;
         document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.modal');
            var instances = M.Modal.init(elems, {});
             modalEdicao = instances[0];
             modalCriacao = instances[1];
             modalDelecao = instances[2];
        });
    </script>
    <script>
      let listaDeOng = [];
      listaDeOng.push({CNPJ: 28984, Email: 'Raquel Jesus',Senha:'2345', Nome: 'Informática', Setor:'ajuda'  });
      listaDeOng.push({CNPJ: 31055, Email: 'Felipe hello',Senha:'2342', Nome: 'Informática', Setor:'doação'  });
      let tabela = document.getElementById('tabela');
      function mostraModal(i){
          modalEdicao.open();
          document.getElementById('ed-CNPJ').value = listaDeOng[i].CNPJ;
          document.getElementById('ed-Email').value = listaDeOng[i].Email;
          document.getElementById('ed-Nome').value = listaDeOng[i].Nome;
          document.getElementById('ed-Setor').value = listaDeOng[i].Setor;
      }
      function mostraModalDelecao(i){
          modalDelecao.open();
          document.getElementById('dl-CNPJ').value = listaDeOng[i].rm;
      }
      function atualiza(){
      /*  fetch('/Ong')
        .then(res => res.json())
        .then(dados => {
            listaDeOng = dados;
            */
            tabela.innerHTML = listaDeOng.map((Ong,i) => `
            <tr>
                    <td>${Ong.CNPJ}</td>
                    <td>${Ong.Email}</td>
                    <td>${Ong.Senha}</td>
                    <td>${Ong.Nome}</td>
                    <td>${Ong.Setor}</td>
                    <td><i onclick="mostraModal(${i})" class="material-icons">edit</i></td>
                    <td><i onclick="mostraModalDelecao(${i})" class="material-icons">close</i></td>
                </tr>
            `).join('');
        
      }
      atualiza();


    function criarOng(){
        const formulario = document.getElementById("form-criacao");
        const data = new URLSearchParams(new FormData(formulario));
        fetch('/Ong', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded'},
            body: data
        })
    }
    
    function editarOng(){
        const formulario = document.getElementById("form-edicao");
        const data = new URLSearchParams(new FormData(formulario));
        fetch('/Ong', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded'},
            body: data
        })
    }
    
    function deletarOng(){
        const rm = document.getElementById('dl-CNPJ').value;
        fetch('/ong/'+ CNPJ, {
            method: 'DELETE'
        })
    }


    </script>
  </body>
</html>